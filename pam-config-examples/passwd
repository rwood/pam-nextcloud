# Example PAM configuration for passwd command
# This file shows how to use pam_nextcloud for password changes
#
# Copy this to /etc/pam.d/passwd or modify your existing passwd PAM configuration
#
# This allows users to change their Nextcloud password using the 'passwd' command

# Password change authentication
# User must authenticate with current password before changing
auth    sufficient  pam_python.so /lib/security/pam_nextcloud.py

# Fallback to local Unix authentication
auth    sufficient  pam_unix.so
auth    required    pam_deny.so

# Account management
account sufficient  pam_python.so /lib/security/pam_nextcloud.py
account sufficient  pam_unix.so
account required    pam_permit.so

# Password changing (this is where the actual password update happens)
password sufficient pam_python.so /lib/security/pam_nextcloud.py

# Fallback to local Unix password change
password sufficient pam_unix.so use_authtok

# Alternative: Make Nextcloud password change required (no local fallback)
# Uncomment these lines and comment out the above if you want to enforce Nextcloud-only
#password required   pam_python.so /lib/security/pam_nextcloud.py

