# Example PAM configuration for LightDM (Display Manager)
# This file shows how to use pam_nextcloud for graphical desktop login
# with desktop integration support
#
# Copy this to /etc/pam.d/lightdm or modify your existing lightdm PAM configuration
#
# This configuration enables:
# - Nextcloud authentication
# - Password caching for offline use
# - Desktop integration (GNOME Online Accounts / KDE Accounts)

# Authentication
auth    sufficient  pam_python.so /lib/security/pam_nextcloud.py

# Fallback to local authentication if Nextcloud unavailable
auth    sufficient  pam_unix.so nullok_secure try_first_pass
auth    requisite   pam_deny.so
auth    required    pam_permit.so

# Account management
account sufficient  pam_python.so /lib/security/pam_nextcloud.py
account sufficient  pam_unix.so
account required    pam_permit.so

# Session management (IMPORTANT for desktop integration)
# Use 'optional' so login succeeds even if desktop integration fails
session optional    pam_python.so /lib/security/pam_nextcloud.py
session required    pam_unix.so
session optional    pam_systemd.so

# Password management (if using passwd command)
password sufficient pam_python.so /lib/security/pam_nextcloud.py
password sufficient pam_unix.so use_authtok

